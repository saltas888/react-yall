{"version":3,"sources":["lib/yall.js","lib/index.js","index.js"],"names":["getEnv","intersectionObserverSupport","window","IntersectionObserverEntry","prototype","idleCallbackSupport","yallCtx","createContext","Provider","_React$Component","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","push","bind","assertThisInitialized","remove","yallLoad","state","yallElements","inherits","createClass","key","value","_this2","options","Yall","intersectionListener","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","intersectionRatio","element","target","idlyLoad","requestIdleCallback","idleCallbackOptions","classList","lazyClass","rootMargin","concat","threshold","lE","observe","disconnect","yallElement","unobserve","flipSrc","tagName","autoplay","load","contains","lazyBackgroundClass","add","lazyBackgroundLoaded","_this3","setState","prevState","toConsumableArray","onAddElement","_this4","filter","e","onRemoveElement","_this5","react_default","a","createElement","className","ref","yallProvider","children","get","timeout","idleLoadTimeout","React","Component","YallImg","_ref2","_this6","dataSrc","src","objectWithoutProperties","_useState","useState","_useState2","slicedToArray","_src","setSrc","useRef","_useContext","useContext","useEffect","current","assign","data-src","YallVideo","_ref4","sources","_useState7","_useState8","videoSrc","setVideoSrc","_useState9","map","s","srcSet","_useState10","sourcesSrcs","setSourcesSrcs","pctRef","sourcesRefs","i","_useContext3","dataSrcSet","type","data-srcset","contextType","defaultProps","PLACHOLDER_IMG_URL","imagesSources","faker","image","imageUrl","Images","id","style","height","width","alt","videoSources","Videos","autoPlay","render","document","title","view","setView","margin","href","onClick","preventDefault","marginLeft","lib_Provider","src_Images","src_Videos","getElementById"],"mappings":"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","file":"static/js/main.25beffc5.chunk.js","sourcesContent":["export const getEnv = () => ({\n  intersectionObserverSupport: \"IntersectionObserver\" in window && \"IntersectionObserverEntry\" in window && \"intersectionRatio\" in window.IntersectionObserverEntry.prototype,\n  idleCallbackSupport: \"requestIdleCallback\" in window\n});\n\nexport const defaultOptions = {\n  lazyClass: \"lazy\",\n  lazyBackgroundClass: \"lazy-bg\",\n  lazyBackgroundLoaded: \"lazy-bg-loaded\",\n  idlyLoad: false,\n  idleLoadTimeout: 100,\n  threshold: 200,\n};","import React, { useContext, useEffect, useRef, useState, createContext } from 'react';\nimport * as Yall from './yall';\n\nconst yallCtx = createContext();\n\nexport class Provider extends React.Component {\n  static contextType = yallCtx;\n  constructor(props) {\n    super(props);\n    \n    this.push = this.push.bind(this);\n    this.remove = this.remove.bind(this);\n    this.yallLoad = this.yallLoad.bind(this);\n    this.state = {\n      yallElements: []\n    };\n  }\n\n  componentDidMount() {\n    const { options } = this.props;\n    if (Yall.getEnv().intersectionObserverSupport === true) {\n      this.intersectionListener = new IntersectionObserver(\n        (entries, observer) => {\n          entries.forEach(entry => {\n            if (entry.isIntersecting === true && entry.intersectionRatio > 0) {\n              const element = entry.target;\n              if (options.idlyLoad === true) {\n                requestIdleCallback(() => this.yallLoad(element), this.idleCallbackOptions);\n              } else {\n                this.yallLoad(element);\n              }\n\n              element.classList.remove(options.lazyClass);\n              this.remove(element);\n            }\n          });\n      }, {\n        rootMargin: `${options.threshold}px 0%`,\n      });\n      this.state.yallElements.forEach(lE => this.intersectionListener.observe(lE));\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.intersectionListener) {\n      this.intersectionListener.disconnect();\n    }\n  }\n\n  get idleCallbackOptions() {\n    const { options } = this.props;\n    return {\n      timeout: options.idleLoadTimeout\n    }\n  }\n\n  onAddElement(yallElement) {\n    if (Yall.getEnv().intersectionObserverSupport === true) {\n      this.intersectionListener.observe(yallElement);\n    }\n  }\n\n  onRemoveElement(yallElement) {\n    if (Yall.getEnv().intersectionObserverSupport === true) {\n      this.intersectionListener.unobserve(yallElement);\n    }\n  }\n  \n  yallLoad(element) {\n    const { options } = this.props;\n    element.flipSrc();\n\n    if (element.tagName === \"VIDEO\" && element.autoplay === true) {\n      element.load();\n    }\n\n    // Lazy load CSS background images\n    if (element.classList.contains(options.lazyBackgroundClass)) {\n      element.classList.remove(options.lazyBackgroundClass);\n      element.classList.add(options.lazyBackgroundLoaded);\n    }\n  }\n\n  push(yallElement) {\n    this.setState(prevState => ({\n      yallElements: [...prevState.yallElements, yallElement]\n    }), () => this.onAddElement(yallElement));\n  }\n\n  remove(yallElement) {\n    this.setState(prevState => ({\n      yallElements: prevState.yallElements.filter(e => e === yallElement)\n    }), () => this.onRemoveElement(yallElement));\n  }\n\n  render() {\n    return (\n      <yallCtx.Provider value={this}>\n        <div className=\"yall-provider-container\" ref={ref => (this.yallProvider = ref)}>\n          {this.props.children}\n        </div>\n      </yallCtx.Provider>\n    );\n  }\n}\n\nProvider.defaultProps = {\n  options: Yall.defaultOptions\n};\n\nexport function YallImg({ dataSrc, src, ...props }) {\n  const [_src, setSrc] = useState(src);\n  const ref = useRef(null);\n  const { push, remove } = useContext(yallCtx);\n  useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n    ref.current.flipSrc = setSrc.bind(this, dataSrc);\n    push(ref.current);\n    return () => remove(ref.current);\n  }, [ref.current !== null]);\n\n  return (\n    <img\n      ref={ref}\n      {...props}\n      src={_src}\n      data-src={dataSrc}\n    />\n  );\n}\n\nexport function YallPicture({ sources, src, dataSrc, ...props }) {\n  const [imgSrc, setImgSrc] = useState(src);\n  const [sourcesSrcs, setSourcesSrcs] = useState(sources.map(s => s.srcSet));\n  const pctRef = useRef(null);\n  const sourcesRefs = sources.map(i => useRef(null));\n\n  const { push, remove } = useContext(yallCtx);\n  useEffect(() => {\n    if (!pctRef.current) {\n      return;\n    }\n    \n    pctRef.current.flipSrc = () => {\n      setImgSrc(dataSrc);\n      setSourcesSrcs(sources.map(s => s.dataSrcSet));\n    };\n    push(pctRef.current);\n    return () => remove(pctRef.current);\n  }, [pctRef.current !== null]);\n\n\n  return (\n    <picture ref={pctRef}>\n      {sources.map((s, i) => (\n        <source\n          ref={sourcesRefs[i]}\n          key={s.media}\n          media={s.media}\n          srcSet={sourcesSrcs[i]}\n          data-srcset={s.dataSrcSet}\n        />\n      ))}\n      <img src={imgSrc} data-src={dataSrc} {...props} />\n    </picture>\n  );\n}\n\n\nexport function YallVideo({ sources, src, dataSrc, children, ...props }) {\n  const [videoSrc, setVideoSrc] = useState(src);\n  const [sourcesSrcs, setSourcesSrcs] = useState(sources && sources.map(s => s.srcSet));\n  const pctRef = useRef(null);\n  const sourcesRefs = sources && sources.map(i => useRef(null));\n\n  const { push, remove } = useContext(yallCtx);\n  useEffect(() => {\n    if (!pctRef.current) {\n      return;\n    }\n    \n    pctRef.current.flipSrc = () => {\n      setVideoSrc(dataSrc);\n      if (sources) {\n        setSourcesSrcs(sources.map(s => s.dataSrcSet));\n      }\n    };\n    push(pctRef.current);\n    return () => remove(pctRef.current);\n  }, [pctRef.current !== null]);\n\n\n  return (\n    <video src={videoSrc} data-src={dataSrc} ref={pctRef} {...props}>\n      {sources && sources.map((s, i) => (\n        <source\n          ref={sourcesRefs[i]}\n          key={s.type}\n          type={s.type}\n          srcSet={sourcesSrcs[i]}\n          data-srcset={s.dataSrcSet}\n        />\n      ))}\n      {children}\n    </video>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { render } from \"react-dom\";\nimport { Provider as YallProvider, YallVideo, YallImg } from \"./lib\";\nimport faker from 'faker';\n\nconst PLACHOLDER_IMG_URL = 'https://dummyimage.com/600x400/000/fff.png&text=placeholder';\n\n\nconst imagesSources = [];\nfor(var i=0; i<50; i++) {\n  imagesSources.push(faker.image.imageUrl());\n}\n\nconst Images = props => (\n  <div className=\"images-container\">\n    {imagesSources.map((s, id) => (\n      <div key={id} style={{height: 500, width: 500}}>\n        <YallImg\n          alt={`Image ${id}`}\n          width=\"100%\"\n          height=\"100%\"\n          src={PLACHOLDER_IMG_URL}\n          dataSrc={s}\n        />  \n      </div>\n    ))}\n  </div>\n); \n\nconst videoSources = [];\nfor(var i=0; i<10; i++) {\n  videoSources.push(\"https://download.blender.org/peach/bigbuckbunny_movies/BigBuckBunny_320x180.mp4\");\n}\nconst Videos = props => (\n  <div className=\"images-container\">\n    {videoSources.map((s, id) => (\n      <div key={id} style={{height: 500, width: 500}}>\n        <YallVideo\n         width=\"100%\"\n         height=\"100%\"\n         autoPlay\n         src={PLACHOLDER_IMG_URL}\n         dataSrc={s}\n       />  \n      </div>\n    ))}\n  </div>\n); \n\n\nconst App = () =>  {\n  useEffect(() => {\n    document.title = 'React Yall Demo';\n  }, [])\n  const [view, setView] = useState('images');\n  return (\n    <div style={{ width: 640, margin: \"15px auto\" }}>\n      <h1>React Yall Demo</h1>\n      <nav>\n      <a href=\"#\" onClick={e => {\n        setView('images');\n        e.preventDefault();\n      }}>Images</a>\n      <a style={{marginLeft: '50px'}} href=\"#\" onClick={e => {\n        setView('videos');\n        e.preventDefault();\n      }}>Videos</a>\n      </nav>\n      <YallProvider>\n      {view === 'images' && <Images />}\n      {view === 'videos' && <Videos />}\n      </YallProvider>\n    </div>\n  );\n};\n\nrender(<App />, document.getElementById(\"root\"));"],"sourceRoot":""}